---
title: "プロンプトからエージェントへ"
description: "単発のプロンプトを超え、AIエージェントが自律的にツールを使い、複雑な臨床タスクを遂行する未来。Function Calling、MCP、マルチエージェントの医療応用を解説。"
slug: "07-01-agents"
order: 27
partId: "part07"
partTitle: "プロンプトの未来"
partOrder: 7
estimatedMinutes: 20
free: false
status: "published"
tags: ["エージェント", "Function Calling", "MCP", "自律型AI", "ツール使用", "マルチエージェント"]
publishedAt: "2026-03-01"
updatedAt: "2026-03-01"
---

## プロンプトの限界とエージェントの台頭

これまでの章では、AIへの「プロンプト」を工夫することで臨床業務を効率化する方法を学んできました。しかし、プロンプトには本質的な限界があります。1回の入力に対して1回の出力を返す――この「一問一答」のパラダイムでは、現実の臨床業務のように複数のシステムを横断し、段階的な判断を積み重ねるタスクに対応しきれません。

この限界を超えるのが **AIエージェント** です。エージェントとは、与えられた目標に対して自律的に計画を立て、外部ツールを使い、結果を評価し、次のアクションを決定するAIシステムです。2025年以降、OpenAI、Anthropic、Googleをはじめとする各社がエージェント機能を急速に強化しており、医療分野への応用も現実のものとなりつつあります。

## プロンプトとエージェントの違い

<ComparisonCard beforeLabel="従来のプロンプト（一問一答）" afterLabel="AIエージェント（自律的タスク遂行）">
  <ComparisonBefore>
医師: 「この患者の検査結果を解釈してください」
AI: 解釈結果を1回で出力
医師: 「ガイドラインと照合してください」
AI: ガイドラインとの照合結果を出力
医師: 「治療計画を作成してください」
AI: 治療計画を出力
→ 毎回、医師が次のステップを指示する必要がある
  </ComparisonBefore>
  <ComparisonAfter>
医師: 「この患者の検査結果から治療計画まで作成してください」
エージェント:
  1. 検査結果を読み取り、異常値を特定（ツール: 検査データ解析）
  2. 関連するガイドラインを自動検索（ツール: ガイドラインDB）
  3. 薬剤の相互作用を確認（ツール: 薬剤DB）
  4. 統合した治療計画を生成
→ 医師は最終確認のみ行う
  </ComparisonAfter>
</ComparisonCard>

## エージェントの構成要素

AIエージェントは以下の4つの要素で構成されます。

<StepFlow>
  <StepFlowStep number={1} title="LLM（推論エンジン）">
    エージェントの「頭脳」。タスクの理解、計画の策定、結果の評価を担う。GPT-4o、Claude、Gemini等の大規模言語モデルがこの役割を果たす。
  </StepFlowStep>
  <StepFlowStep number={2} title="ツール（外部機能）">
    エージェントの「手足」。データベース検索、計算、API呼び出し、ファイル操作など、LLM単体ではできない操作を実行する。
  </StepFlowStep>
  <StepFlowStep number={3} title="メモリ（文脈保持）">
    短期メモリ（会話内の情報）と長期メモリ（過去のやり取りの蓄積）を管理し、一貫性のある対応を可能にする。
  </StepFlowStep>
  <StepFlowStep number={4} title="オーケストレーション（実行制御）">
    ツールの呼び出し順序、エラー時のリトライ、タスクの分割と統合を制御するロジック。エージェントの「自律性」の核。
  </StepFlowStep>
</StepFlow>

## Function Calling: エージェントの基盤技術

Function Calling（関数呼び出し）は、LLMが「どのツールを、どのパラメータで呼び出すか」を構造化された形式で出力する仕組みです。これにより、AIが外部システムと安全に連携できるようになります。

<PromptTemplate title="Function Callingの医療応用：薬剤相互作用チェック">
あなたは薬剤情報の専門AIアシスタントです。

以下のツール（関数）を利用できます：

【利用可能なツール】

■ check_drug_interaction
  説明: 2つの薬剤間の相互作用を確認する
  パラメータ:
    - drug_a: string（薬剤名）
    - drug_b: string（薬剤名）
  戻り値: 相互作用の有無、重大度、臨床的影響

■ get_drug_dosage
  説明: 薬剤の添付文書に基づく用法用量を取得する
  パラメータ:
    - drug_name: string（薬剤名）
    - indication: string（適応症）
    - renal_function: number（eGFR値、任意）
  戻り値: 推奨用量、腎機能別調整、注意事項

■ search_guidelines
  説明: 日本の臨床ガイドラインを検索する
  パラメータ:
    - condition: string（疾患名）
    - society: string（学会名、任意）
  戻り値: 該当するガイドラインの推奨事項

【タスク】
患者の現在の処方内容を確認し、新規追加薬剤との相互作用を全組み合わせでチェックしてください。問題が見つかった場合は代替薬をガイドラインから提案してください。

【患者情報】
- 現在の処方: [処方リスト]
- 新規追加予定薬剤: [薬剤名]
- eGFR: [値]
- 適応症: [疾患名]

【出力形式】
1. 相互作用チェック結果（全組み合わせの表）
2. 問題のある組み合わせの詳細
3. 代替薬の提案（該当する場合）
4. 用量調整の推奨（腎機能考慮）
</PromptTemplate>

## MCP（Model Context Protocol）: ツール接続の標準化

MCP（Model Context Protocol）は、Anthropicが2024年に提唱したオープンプロトコルで、AIモデルと外部データソース・ツールを標準化された方法で接続するための仕組みです。従来、各AIプラットフォームごとにツール連携の方法が異なっていましたが、MCPにより「AIツール接続のUSB-C」とも言える統一規格が実現しつつあります。

### MCPの医療分野での可能性

MCPを活用すると、以下のような医療ツールサーバーを構築し、任意のAIクライアントから利用できるようになります。

<PromptTemplate title="MCP医療ツールサーバーの設計構想">
以下は、MCPプロトコルに準拠した医療ツールサーバーの設計案です。

【MCPサーバー: 医療情報ハブ】

■ ツール1: pmda_drug_search
  説明: PMDA（医薬品医療機器総合機構）の添付文書情報を検索
  入力: 薬剤名（一般名または商品名）
  出力: 添付文書の主要情報（適応、用法用量、禁忌、相互作用）

■ ツール2: guideline_search
  説明: 日本の主要学会ガイドラインを検索
  入力: 疾患名、学会名（任意）
  出力: 推奨グレード付きの治療推奨

■ ツール3: lab_interpreter
  説明: 検査値の基準範囲と臨床的意義を返す
  入力: 検査項目名、検査値、患者年齢・性別
  出力: 基準範囲、異常の方向、考えられる原因リスト

■ ツール4: icd_coder
  説明: 臨床記述からICD-10コードを提案
  入力: 診断名または臨床記述（日本語）
  出力: 候補ICD-10コード（複数）、各コードの説明

■ ツール5: clinical_calculator
  説明: 臨床スコア・リスク計算を実行
  入力: 計算式名（CHA2DS2-VASc、CURB-65等）、必要パラメータ
  出力: スコア値、リスク分類、推奨アクション

【接続方式】
- プロトコル: MCP（Model Context Protocol）
- トランスポート: stdio または HTTP/SSE
- 認証: OAuth 2.0ベースのアクセス制御
- 対応クライアント: Claude Desktop、Cursor、その他MCP対応アプリケーション
</PromptTemplate>

<Callout>
MCPのメリット：
- **標準化**: 一度ツールサーバーを構築すれば、どのMCP対応AIクライアントからも利用可能
- **セキュリティ**: ローカル実行が基本。患者データがクラウドに送信されないアーキテクチャが可能
- **拡張性**: 新しいツールの追加が容易。施設独自のデータベースとの連携も可能
- **オープン**: 特定のAIベンダーに依存しない。オープンソースで実装可能
</Callout>

## 医療エージェントワークフローの実例

### 実例1: 入院時の包括的薬剤レビュー

<PromptTemplate title="エージェントワークフロー: 入院時薬剤レビュー">
あなたは薬剤レビューを行う臨床薬剤師AIエージェントです。
以下のワークフローに従って、入院患者の薬剤を包括的にレビューしてください。

【エージェントワークフロー】

ステップ1: 処方内容の整理
→ ツール: なし（入力データの構造化）
→ 出力: 薬剤リスト（一般名、用量、適応、開始日）

ステップ2: 重複・類似薬チェック
→ ツール: drug_classification_check
→ 出力: 同一薬効群の重複があれば警告

ステップ3: 相互作用チェック
→ ツール: check_drug_interaction（全組み合わせ）
→ 出力: 相互作用マトリクス

ステップ4: 腎機能ベースの用量確認
→ ツール: get_drug_dosage（各薬剤、eGFR値を付与）
→ 出力: 用量適切性の評価

ステップ5: ポリファーマシー評価
→ ツール: polypharmacy_risk_score
→ 出力: リスクスコアと減薬候補

ステップ6: 統合レポート生成
→ 出力形式:

【入院時薬剤レビュー報告書】
■ 患者概要: [年齢、性別、主要診断、eGFR]
■ 現在の処方: [薬剤数]剤
■ 重複薬: [有/無]（詳細）
■ 相互作用: [件数]件（重大度別）
■ 用量調整が必要な薬剤: [リスト]
■ 減薬候補: [リスト]
■ 薬剤師コメント: [総合評価]
■ 推奨アクション: [優先順位付きリスト]

注: このレポートはAIによる初期スクリーニング結果です。
最終判断は担当薬剤師・医師が行ってください。
</PromptTemplate>

### 実例2: 文献検索から治療推奨の生成

<PromptTemplate title="エージェントワークフロー: エビデンスベースの治療推奨">
あなたは臨床意思決定を支援するAIエージェントです。
以下の臨床疑問に対して、エビデンスに基づいた治療推奨を生成してください。

【臨床疑問】
[PICO形式で記述]
P（患者）: [対象患者の特徴]
I（介入）: [検討中の治療介入]
C（比較）: [比較対象]
O（アウトカム）: [評価したいアウトカム]

【エージェントの実行ステップ】

ステップ1: 文献検索
→ ツール: pubmed_search, cochrane_search
→ 検索式を自動生成し、関連文献を取得

ステップ2: エビデンスの評価
→ ツール: evidence_grader
→ 各文献のエビデンスレベルを評価（RCT、メタ解析等）

ステップ3: ガイドラインとの照合
→ ツール: guideline_search
→ 日本および国際ガイドラインの推奨を取得

ステップ4: 統合と推奨の生成
→ 文献エビデンスとガイドラインを統合し、治療推奨を作成

【出力形式】
■ 臨床疑問のPICO要約
■ 検索結果の概要（文献数、エビデンスレベル分布）
■ 主要文献のサマリー（上位5件）
■ ガイドラインの推奨（推奨グレード付き）
■ 統合した治療推奨
  - 推奨度: [強い推奨/弱い推奨/推奨なし]
  - エビデンスの質: [高/中/低/非常に低]
  - 推奨の根拠: [要約]
■ 注意事項と限界
</PromptTemplate>

## マルチエージェントシステム

複数のAIエージェントが協働して一つのタスクを遂行する「マルチエージェントシステム」は、医療における複雑な意思決定に特に適しています。

<PromptTemplate title="マルチエージェント: カンファレンス型の臨床検討">
以下の症例について、複数の専門家エージェントによるバーチャルカンファレンスを実施してください。

【症例】
[症例情報を入力]

【参加エージェント】

■ エージェント1: 主治医（総合内科）
  役割: 症例全体の統括、鑑別診断の整理
  使用ツール: guideline_search, clinical_calculator

■ エージェント2: 専門医コンサルタント
  役割: 専門領域の観点から鑑別の精緻化、追加検査の提案
  使用ツール: pubmed_search, evidence_grader

■ エージェント3: 薬剤師
  役割: 薬物療法の最適化、相互作用チェック
  使用ツール: check_drug_interaction, get_drug_dosage

■ エージェント4: 安全管理者
  役割: 全提案の安全性チェック、リスク評価
  使用ツール: adverse_event_checker, contraindication_checker

【カンファレンスの進行】
1. 主治医が症例を提示し、初期評価を述べる
2. 専門医が専門的視点からコメント
3. 薬剤師が薬物療法について検討
4. 安全管理者が全提案をレビュー
5. 全エージェントが統合方針を議論
6. 最終合意（合意に至らない場合は意見の相違点を明記）

【出力形式】
■ カンファレンスサマリー
■ 合意事項
■ 未解決の論点
■ 推奨アクションプラン
■ フォローアップ計画
</PromptTemplate>

## 自律型エージェントの安全設計

エージェントが自律的に動作するからこそ、安全設計が極めて重要になります。

<StepFlow>
  <StepFlowStep number={1} title="Human-in-the-Loop（人間の関与）">
    重要な判断ポイントでは必ず人間の承認を挟む。特に処方の変更、検査のオーダー、患者への情報提供の前には医師の確認を必須とする。
  </StepFlowStep>
  <StepFlowStep number={2} title="ツール実行の権限管理">
    読み取り専用ツール（検索、計算）と書き込みツール（オーダー入力、記録更新）を明確に区別する。書き込みツールの実行には追加の認証を要求する。
  </StepFlowStep>
  <StepFlowStep number={3} title="監査ログの記録">
    エージェントが実行した全てのアクション（ツール呼び出し、判断根拠、中間結果）をログに記録する。事後検証が可能な状態を維持する。
  </StepFlowStep>
  <StepFlowStep number={4} title="フォールバック戦略">
    エージェントが確信度の低い判断に直面した場合、自律的な行動を停止し、人間に判断を委ねるルールを設定する。「分からないことは止まる」設計が不可欠。
  </StepFlowStep>
</StepFlow>

<Warning>
AIエージェントは強力なツールですが、医療における最終的な意思決定の責任は常に医師にあります。エージェントの「自律性」は、あくまで情報収集・分析・提案の範囲に限定し、診断の確定や治療の決定は人間が行う設計にしてください。「AIが決めた」は、法的にも倫理的にも許容されません。
</Warning>

## 今日から始めるエージェント体験

エージェントの概念は先端的ですが、今日から使えるツールも増えています。

<PromptTemplate title="ChatGPT / Claude でのエージェント的活用">
以下の手順で、現在利用可能なAIツールでもエージェント的なワークフローを体験できます。

【準備】
- ChatGPT Plus（GPTs + Code Interpreter + Web Browsing）
- Claude Pro（Projects + Artifacts + Web検索）
- いずれかを使用

【ステップ1: ツールを明示的に指定する】
「以下の作業を順番に実行してください。
 1. Webで○○を検索し、最新の情報を取得
 2. 取得した情報を表形式で整理
 3. 整理した情報に基づいて○○を計算
 4. 結果を臨床的に解釈」

【ステップ2: 中間確認を入れる】
「各ステップの完了後に結果を報告し、次に進む前に私の確認を求めてください」

【ステップ3: 品質チェックを組み込む】
「全ステップ完了後、自分の出力を再度チェックし、
 矛盾や誤りがないか自己検証してください」

【実践例】
「以下のタスクを順番に実行してください：
 1. CHA2DS2-VAScスコアを計算（年齢75歳、男性、高血圧あり、糖尿病あり）
 2. 計算結果に基づいて抗凝固療法の推奨を述べる
 3. 日本循環器学会のガイドラインとの整合性を確認
 4. 腎機能（eGFR 45）を考慮した薬剤選択を提案
 各ステップの結果を示した後、次に進んでください。」
</PromptTemplate>

<Callout>
エージェント時代に向けた医療者の準備：
- **まずはプロンプトの基礎を固める**: エージェントの指示設計もプロンプトの延長線上にある
- **ツール連携を理解する**: Function CallingやMCPの概念を理解しておく
- **安全設計を学ぶ**: 自律的なAIを安全に運用するための設計思想を身につける
- **ワークフローを棚卸しする**: 自分の日常業務のどこにエージェントが活用できるかを整理する
- **施設のIT部門と連携する**: エージェントの本格導入にはシステム連携が必要
</Callout>

<KeyTakeaway>
AIエージェントは、プロンプトの一問一答を超えて、LLMがツールを自律的に活用し、複雑なタスクを遂行するパラダイムです。Function Callingでツールとの連携を実現し、MCP（Model Context Protocol）で接続を標準化し、マルチエージェントシステムで多角的な臨床検討を可能にします。ただし、医療における安全設計（Human-in-the-Loop、権限管理、監査ログ、フォールバック）は不可欠です。エージェントの時代においても、プロンプト設計の基礎と医療者としての判断力が最も重要な資産であることは変わりません。
</KeyTakeaway>
