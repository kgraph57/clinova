---
title: "コンテキストウィンドウ管理と臨床データ"
description: "LLMのコンテキストウィンドウを効率的に活用し、臨床データを最適な形で入力する技術を解説します。"
slug: "01-03-context-management"
order: 3
partId: "part01"
partTitle: "プロンプト設計の基本原則"
partOrder: 1
estimatedMinutes: 18
free: true
status: "published"
tags: ["コンテキストウィンドウ", "臨床データ", "トークン管理", "データ構造化"]
publishedAt: "2026-03-01"
updatedAt: "2026-03-01"
---

## コンテキストウィンドウとは

LLM（大規模言語モデル）が一度に処理できるテキスト量には上限があります。これを「コンテキストウィンドウ」と呼びます。2026年現在、主要なモデルのコンテキストウィンドウは以下の通りです。

- Claude 3.5/4系: 200,000トークン（約30万文字）
- GPT-4o: 128,000トークン（約19万文字）
- Gemini 1.5 Pro: 2,000,000トークン（約300万文字）

一見十分に思えますが、臨床データは膨大になりがちです。電子カルテの経過記録、検査結果の一覧、画像レポート、看護記録など、1人の患者のデータだけでも相当な量になります。

## なぜコンテキスト管理が重要か

コンテキストウィンドウの使い方は、AIの回答品質に直結します。

<ComparisonCard beforeLabel="カルテ丸投げ" afterLabel="構造化された情報提供">
<ComparisonBefore>

以下は過去3年分の全カルテです。[30ページ分のカルテテキスト] この患者の現在の問題を分析してください。

</ComparisonBefore>
<ComparisonAfter>

以下の患者について、現在のアクティブな問題を分析してください。

【現在のアクティブ問題】
#1 2型糖尿病（HbA1c 8.5%、3ヶ月前 7.9%）
#2 CKDステージ3b（eGFR 38、6ヶ月前 42）
#3 高血圧（最近のBP平均 145/88）

【直近の処方変更】
2025/12: メトホルミン 1500→1000mgに減量（eGFR低下のため）

【直近の検査推移（3ヶ月間）】
HbA1c: 7.9→8.2→8.5%
eGFR: 42→40→38
K: 4.5→4.7→4.9

上記3問題の相互関連と治療最適化案を提案してください。

</ComparisonAfter>
</ComparisonCard>

## 臨床データの優先順位付け

コンテキストウィンドウを効率的に使うために、臨床データには優先順位をつけて投入します。

<StepFlow>
  <StepFlowStep number={1} title="必須情報（Always Include）">
    主訴、現病歴のサマリー、アクティブな問題リスト、現在の処方、直近のバイタルサイン、アレルギー情報
  </StepFlowStep>
  <StepFlowStep number={2} title="重要情報（Usually Include）">
    関連する既往歴、直近の検査結果（異常値中心）、画像検査の所見サマリー、最近の処方変更
  </StepFlowStep>
  <StepFlowStep number={3} title="補足情報（Include If Relevant）">
    家族歴、社会歴、経時的な検査推移、看護記録のサマリー
  </StepFlowStep>
  <StepFlowStep number={4} title="省略可能（Omit Unless Needed）">
    正常範囲内の検査結果、古い既往歴の詳細、定型的なバイタル記録
  </StepFlowStep>
</StepFlow>

## データ圧縮テクニック

臨床データを効率的に圧縮する具体的なテクニックを紹介します。

### テクニック1: 異常値フォーカス

<PromptTemplate title="検査結果の効率的な提示（異常値フォーカス）">
【検査結果サマリー（異常値のみ抽出）】
日付: 2025/12/15

血算: WBC 12,500↑ (Neut 82%↑), Hb 10.2↓, Plt 正常
生化: Cr 1.8↑, BUN 32↑, eGFR 35↓, K 5.1↑, Na 正常
    AST/ALT 正常, Alb 3.0↓
    CRP 8.5↑, PCT 0.85↑
凝固: 正常
血糖: HbA1c 8.5↑, 随時血糖 245↑

※ 記載のない項目は全て基準値内

[以上の検査結果に基づく臨床質問]
</PromptTemplate>

### テクニック2: 経時的変化の要約

<PromptTemplate title="経時変化の効率的提示">
【腎機能推移（過去12ヶ月）】
eGFR: 55→50→45→42→38 (mL/min/1.73m²)
Cr:   1.1→1.2→1.3→1.4→1.6 (mg/dL)
BUN:  18→20→24→28→32 (mg/dL)
K:    4.2→4.4→4.5→4.7→5.1 (mEq/L)
尿蛋白: (+)→(+)→(++)→(++)→(+++)

傾向: eGFR 年間約17mL/min低下（急速進行性）
      高K血症が出現・増悪傾向

この腎機能悪化速度の評価と、急速進行性の原因検索プランを提案してください。
</PromptTemplate>

### テクニック3: 問題指向型サマリー

<PromptTemplate title="問題指向型データ構造化">
【問題リスト（アクティブ）】

#1 急性腎障害（AKI）- KDIGO Stage 2
   - Cr: ベースライン0.9→現在2.1（48時間で上昇）
   - 尿量: 0.4mL/kg/hr × 6時間
   - 原因精査中（腎前性 vs 腎性）
   - 補液開始済み

#2 敗血症疑い
   - 発熱38.8℃、WBC 18,000、CRP 15.2、PCT 2.1
   - 血液培養2セット採取済み（結果待ち）
   - 尿路感染源の可能性（膿尿あり）
   - MEPM 1g q12h開始（腎機能調整済み）

#3 心房細動（既知・慢性）
   - DOAC内服中→AKIのため一時中止
   - HR 110bpmでrate control不十分

上記3問題の関連性を分析し、包括的な管理プランを提案してください。
</PromptTemplate>

## 長文データの分割戦略

電子カルテの記録が長大な場合、データを分割して段階的に処理する戦略が有効です。

<PromptTemplate title="段階的データ処理プロンプト">
これから3段階に分けて患者情報を提供します。
全ての情報を受け取った後に、分析を行ってください。

【第1段階：基本情報と問題リスト】
[基本情報を入力]

上記を確認しました。続けて第2段階の情報を提供します。

【第2段階：検査結果と画像所見】
[検査・画像データを入力]

確認しました。最後の段階です。

【第3段階：治療経過と現在の処方】
[治療経過を入力]

以上の全情報に基づき、以下の分析を行ってください：
1. 現在の最も重要な臨床課題
2. 見落とされている可能性のある問題点
3. 治療最適化の提案
</PromptTemplate>

## プライバシーに配慮したデータ入力

<Warning>
AIにカルテ情報を入力する際は、必ず以下の個人識別情報を除去してください：
- 氏名 → 「A氏」「患者X」
- 生年月日 → 年齢のみ記載
- 住所 → 不要なら省略
- ID番号 → 省略
- 連絡先 → 省略
- 施設名 → 「当院」「前医」
上記の除去は手動で行うか、施設の匿名化ツールを使用してください。
</Warning>

<PromptTemplate title="匿名化テンプレート">
以下の臨床情報は匿名化済みです。

【患者】[年齢][性別]（ID等の識別情報は除去済み）
【施設】当院（三次救急対応の総合病院）

[匿名化された臨床データ]

上記に基づき、[質問内容]についてご助言ください。

※本データは匿名化処理済みであり、個人を特定できる情報は含まれていません。
</PromptTemplate>

## コンテキスト効率の測定

自分のプロンプトのコンテキスト効率を評価するための指標です。

<Callout>
コンテキスト効率チェック：
- **情報密度**: 入力した情報のうち、回答に実際に使われた情報の割合は？
- **冗長性**: 同じ情報を異なる表現で重複して入力していないか？
- **ノイズ比**: 質問と無関係な情報がどれだけ含まれているか？
- **構造化度**: AIが情報を正しく識別できる構造になっているか？
</Callout>

<KeyTakeaway>
コンテキストウィンドウは有限のリソースです。臨床データを「異常値フォーカス」「経時的変化の要約」「問題指向型サマリー」の3つのテクニックで圧縮し、優先順位をつけて投入することで、AIの回答品質を最大化できます。また、患者の個人識別情報は必ず除去してから入力してください。
</KeyTakeaway>
